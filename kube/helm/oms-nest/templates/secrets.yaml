{{/*
  Secret structure documentation and secure management guide.

  ============================================================
  OPTION 1: Sealed Secrets (RECOMMENDED for GitOps)
  ============================================================
  Enable in values.yaml:
    sealedSecrets:
      enabled: true

  Then use the manage-secrets.sh script:
    ./kube/scripts/manage-secrets.sh seal oms-nest-staging secrets.env

  This generates an encrypted SealedSecret YAML that is safe to
  commit to Git. The sealed-secrets controller decrypts it in-cluster.

  ============================================================
  OPTION 2: Jenkins Credential Sync (current default)
  ============================================================
  Secrets are stored in Jenkins Credential Manager and synced to
  Kubernetes during deployment via the 'Sync Secrets' stage in
  kube/Jenkinsfile.deploy.

  Required Jenkins credentials:
    - oms-db-credentials       (Username/Password)
    - oms-jwt-secret           (Secret text)
    - oms-encryption-secret    (Secret text)
    - oms-redis-password       (Secret text)
    - oms-mail-credentials     (Username/Password)
    - ghcr-credentials         (Username/Password)

  ============================================================
  OPTION 3: GitHub Actions Secret Sync
  ============================================================
  Used by .github/workflows/staging-deployment.yml for the
  staging-v2 namespace. Secrets are stored as GitHub repository
  secrets and injected via kubectl during deployment.

  Required GitHub secrets:
    DB_USERNAME, DB_PASSWORD, DB_NAME, DB_HOST,
    JWT_SECRET_KEY, REDIS_HOST, REDIS_PASSWORD,
    ENCRYPTION_SECRET, DIGITALOCEAN_ACCESS_TOKEN

  ============================================================
  OPTION 4: Manual creation (emergency / initial setup)
  ============================================================
  The secret "oms-nest-secrets" must be created in each namespace.

  Required keys:
    DATABASE_HOST        - PostgreSQL host
    DATABASE_PORT        - PostgreSQL port (default: 25060 for DO managed)
    DATABASE_USERNAME    - Database username
    DATABASE_PASSWORD    - Database password
    DATABASE_NAME        - Database name (e.g., oms-nest-staging)
    DATABASE_SSL_ENABLED - Set to "true" for DO managed PostgreSQL

    AUTH_JWT_SECRET      - JWT signing secret (min 32 chars)
    AUTH_JWT_TOKEN_EXPIRES_IN - JWT token expiration (e.g., 1d)
    AUTH_REFRESH_SECRET  - JWT refresh token secret (min 32 chars)
    AUTH_REFRESH_TOKEN_EXPIRES_IN - Refresh token expiration (e.g., 7d)

    REDIS_HOST           - Redis host
    REDIS_PORT           - Redis port
    REDIS_PASSWORD       - Redis password

    MAIL_HOST            - SMTP host
    MAIL_PORT            - SMTP port
    MAIL_USER            - SMTP username
    MAIL_PASSWORD        - SMTP password
    MAIL_DEFAULT_EMAIL   - Default from email
    MAIL_DEFAULT_NAME    - Default from name

    ENCRYPTION_SECRET    - Application encryption key (min 32 chars)

  Example manual creation:
    kubectl create secret generic oms-nest-secrets \
      --from-literal=DATABASE_HOST=<host> \
      --from-literal=DATABASE_PORT=25060 \
      --from-literal=DATABASE_USERNAME=<user> \
      --from-literal=DATABASE_PASSWORD=<pass> \
      --from-literal=DATABASE_NAME=oms-nest-staging \
      --from-literal=DATABASE_SSL_ENABLED=true \
      --from-literal=AUTH_JWT_SECRET=<secret-min-32-chars> \
      --from-literal=AUTH_JWT_TOKEN_EXPIRES_IN=1d \
      --from-literal=AUTH_REFRESH_SECRET=<secret-min-32-chars> \
      --from-literal=AUTH_REFRESH_TOKEN_EXPIRES_IN=7d \
      --from-literal=REDIS_HOST=oms-nest-staging-redis \
      --from-literal=REDIS_PORT=6379 \
      --from-literal=REDIS_PASSWORD=<redis-pass> \
      --from-literal=MAIL_HOST=smtp.example.com \
      --from-literal=MAIL_PORT=587 \
      --from-literal=MAIL_USER=<user> \
      --from-literal=MAIL_PASSWORD=<pass> \
      --from-literal=MAIL_DEFAULT_EMAIL=noreply@ordermysaddle.com \
      --from-literal=MAIL_DEFAULT_NAME="OMS Nest" \
      --from-literal=ENCRYPTION_SECRET=<secret-min-32-chars> \
      -n oms-nest-staging

  Verify with:
    ./kube/scripts/manage-secrets.sh verify oms-nest-staging

  ============================================================
  SECURITY RULES
  ============================================================
  - NEVER commit plaintext secrets to Git
  - NEVER log or echo secret values in CI/CD pipelines
  - ALWAYS use 'set +x' before commands that handle secrets
  - ALWAYS use --dry-run=client -o yaml | kubectl apply -f - pattern
  - Rotate secrets at least every 90 days
  - Use separate secrets per environment (staging vs production)
  - Use minimum 32-character random strings for JWT/encryption keys
  - Generate secrets with: openssl rand -base64 32
*/}}
